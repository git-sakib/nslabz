function login(t){FB.login(t,{scope:"user_friends"})}function loginCallback(t){"connected"!=t.status&&(top.location.href="https://www.facebook.com/appcenter/letter-run")}function onStatusChange(t){"connected"!=t.status?login(loginCallback):getMe(function(){getPermissions(function(){hasPermission("user_friends")&&getFriends(function(){showFriends()})}),showUser(),loadUserData()})}function onAuthResponseChange(){}function getMe(t){FB.api("/me",{fields:"id,name,first_name,picture.width(120).height(120)"},function(e){e.error?console.error("/me",e):(user=e,t())})}function getFriends(t){FB.api("/me/friends",function(e){e.error?console.error("/me/friends",e):(friends=e.data,t())})}function getPermissions(t){FB.api("/me/permissions",function(e){e.error?console.error("/me/permissions",e):(perms=e.data,t())})}function hasPermission(t){for(var e in perms)if(perms[e].permission==t&&"granted"==perms[e].status)return!0;return!1}var user={},friends={},players={},perms={},userDataTable=[],curUser,userCount=0;FB.init({appId:"100901070243485",xfbml:!0,status:!0,version:"v2.3"}),FB.Event.subscribe("auth.authResponseChange",onAuthResponseChange),FB.Event.subscribe("auth.statusChange",onStatusChange);var showUser=function(){$("#user div").find("img").attr("src",user.picture.data.url),$("#user").find("p").html(user.name)},isUserExists=function(){for(var t=0;userCount>t;t++)if(user.id===userDataTable[t].id)return curUser=userDataTable[t],!0;return!1},createUser=function(){var t={id:user.id,name:user.name,best:bestGamePoint,total:totalGamePoint,jackfruit:0,mango:0,banana:0,lemon:0,distance:0};userDataTable.push(t),curUser=userDataTable[userCount],userCount++,console.log(userDataTable)},saveUserData=function(){$.ajax({type:"GET",dataType:"json",async:!0,url:"data/get-json.php",data:{data:JSON.stringify({users:userDataTable})},success:function(){console.log("data saved!")},failure:function(){console.log("error!")}})},updateUserData=function(){if(isUserExists()){var t=curUser;bestGamePoint>t.best&&(t.best=bestGamePoint),t.total=parseInt(1*t.total)+parseInt(1*totalPoint),t.distance=parseInt(1*t.distance)+parseInt(1*runDistance),t.jackfruit=parseInt(1*t.jackfruit)+parseInt(1*fruitCount.jackfruit),t.mango=parseInt(1*t.mango)+parseInt(1*fruitCount.mango),t.banana=parseInt(1*t.banana)+parseInt(1*fruitCount.banana),t.lemon=parseInt(1*t.lemon)+parseInt(1*fruitCount.lemon),curUser=t,showUserStats(),showLeaderboard()}},resetUserData=function(){if(isUserExists()){var t=curUser;bestGamePoint=t.best,totalGamePoint=t.total}},loadUserData=function(){$.getJSON("data/user-table.json",function(t){userDataTable=t.users,userCount=userDataTable.length,console.log(userCount),isUserExists()||createUser(),showUserStats(),showLeaderboard()})},showFriends=function(){},showUserStats=function(){var t=curUser;bestGamePoint=t.best,totalGamePoint=t.total;var e="";e+='<table><tr><td colspan="100%" class="title">Statistics</td></tr>',e+='<tr><td class="uname"><img src="images/stats/best.png"> <p>Best Score</p></td> <td class="uscore">'+t.best+"</td></tr>",e+='<tr><td class="uname"><img src="images/stats/jackfruit.png"> <p>Jackfruits</p></td> <td class="uscore">'+t.jackfruit+"</td></tr>",e+='<tr><td class="uname"><img src="images/stats/mango.png"> <p>Mangos</p></td> <td class="uscore">'+t.mango+"</td></tr>",e+='<tr><td class="uname"><img src="images/stats/banana.png"> <p>Bananas</p></td> <td class="uscore">'+t.banana+"</td></tr>",e+='<tr><td class="uname"><img src="images/stats/lemon.png"> <p>Lemons</p></td> <td class="uscore">'+t.lemon+"</td></tr>",e+='<tr><td class="uname"><img src="images/stats/distance.png"> <p>Total Distance</p></td> <td class="uscore">'+t.distance+"</td></tr>",e+='<tr><td class="uname"><img src="images/stats/total.png"> <p>Total Score</p></td> <td class="uscore">'+t.total+"</td></tr>",e+='<tr><td class="uname"><img src="images/stats/letter.png"> <p>Letter Progress</p></td> <td class="letter"><div style="background: '+getLetterImg(t.total)+' no-repeat;"></div></td></tr>',e+="</table>",$("#stats").find(".content").html(e)},getLetterImg=function(t){var e=-50*parseInt(t/NEXT_LETTER_POINT),s="url(images/stats/letters.png) "+e+"px 0";return s},sortUserData=function(){var t;do{t=!1;for(var e=0;e<userDataTable.length-1;e++)if(userDataTable[e].best<userDataTable[e+1].best){var s=userDataTable[e];userDataTable[e]=userDataTable[e+1],userDataTable[e+1]=s,t=!0}}while(t)},showLeaderboard=function(){var t="";t+='<table><tr><td colspan="100%" class="title">LeaderBoard</td></tr>';var e=0;sortUserData(),console.log(userDataTable),console.log(curUser);for(var s=0;s<userDataTable.length&&!(s>=10);s++)usr=userDataTable[s],t+="<tr>",t+="<td>#"+ ++e+"</td>",t+='<td class="pic"><img src="https://graph.facebook.com/'+usr.id+'/picture" /></td>',t+='<td class="uname">'+usr.name+"</td>",t+='<td class="uscore">'+usr.best+"</td>",t+='<td class="letter" style="background: '+getLetterImg(usr.total)+' no-repeat;"></td>',t+=1==e?'<td><img src="images/medal.png" /></td>':"<td>&nbsp;</td>",t+="</tr>";t+="</table>",$("#scores").find(".content").html(t)};$(document).keydown(function(t){switch(t.keyCode){case 37:t.preventDefault();break;case 38:t.preventDefault();break;case 39:t.preventDefault();break;case 40:t.preventDefault()}});